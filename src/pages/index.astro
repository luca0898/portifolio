---
import "../styles/global.css";
import AboutSection from "../components/AboutSection.astro";
import CertificationsSection from "../components/CertificationsSection.astro";
import CvModal from "../components/CvModal.astro";
import EducationSection from "../components/EducationSection.astro";
import ExperienceSection from "../components/ExperienceSection.astro";
import HeroSection from "../components/HeroSection.astro";
import ProjectsSection from "../components/ProjectsSection.astro";
import ReferencesSection from "../components/ReferencesSection.astro";
import SiteFooter from "../components/SiteFooter.astro";
import SiteHeader from "../components/SiteHeader.astro";
import SkillsSection from "../components/SkillsSection.astro";
import { translations } from "../data/translations.js";

const siteUrl = "https://lucaguiraldello.net";
const title = "Luca Guiraldello — Fullstack Developer";
const description = "Portfólio profissional com projetos em .NET, cloud, arquitetura e engenharia de software.";
const image = `${siteUrl}/images/profile.jpg`;

const navItems = [
  { href: "#sobre", key: "nav.about", label: "Sobre" },
  { href: "#experiencias", key: "nav.experience", label: "Experiências" },
  { href: "#formacoes", key: "nav.education", label: "Formações" },
  { href: "#habilidades", key: "nav.skills", label: "Habilidades" },
  { href: "#projetos", key: "nav.projects", label: "Projetos" },
  { href: "#referencias", key: "nav.references", label: "Referências" },
];
---

<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="/favicon/favicon.ico" sizes="any" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png" />
    <link rel="apple-touch-icon" href="/favicon/apple-touch-icon.png" />
    <meta
      id="meta-description"
      name="description"
      content="Portfólio de desenvolvedor fullstack com foco em .NET e backend."
    />
    <meta name="robots" content="index, follow" />
    <title>{title}</title>
    <meta name="description" content={description} />

    <!-- Open Graph -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={siteUrl} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={image} />

    <!-- WhatsApp / Facebook -->
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />

    <!-- Twitter (funciona no WhatsApp também) -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={image} />
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-P8SYZSY0R9"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-P8SYZSY0R9');
    </script>
  </head>
  <body class="bg-slate-950 text-slate-100 antialiased">
    <SiteHeader navItems={navItems} />

    <main id="topo" class="mx-auto w-full max-w-6xl px-4 pb-16 pt-12 sm:px-6 lg:pb-24">
      <HeroSection />
      <AboutSection />
      <ExperienceSection />
      <EducationSection />
      <CertificationsSection />
      <SkillsSection />
      <ProjectsSection />
      <ReferencesSection />
    </main>

    <CvModal />

    <SiteFooter />

    <script define:vars={{ translations }}>
      const toggle = document.getElementById("menu-toggle");
      const menu = document.getElementById("mobile-menu");
      const langToggle = document.getElementById("lang-toggle");
      const langToggleMobile = document.getElementById("lang-toggle-mobile");
      const metaDescription = document.getElementById("meta-description");
      const cvModalOpen = document.getElementById("cv-modal-open");
      const cvModal = document.getElementById("cv-modal");
      const cvModalClose = document.getElementById("cv-modal-close");
      const cvDownloadLink = document.querySelector("[data-cv-download='true']");


      const applyTranslations = (lang) => {
        const dictionary = translations[lang] || translations.pt;
        document.querySelectorAll("[data-i18n]").forEach((element) => {
          const key = element.getAttribute("data-i18n");
          if (key && dictionary[key]) {
            element.textContent = dictionary[key];
          }
        });
        if (metaDescription) {
          metaDescription.setAttribute("content", dictionary.metaDescription);
        }
        if (dictionary.pageTitle) {
          document.title = dictionary.pageTitle;
        }
        document.documentElement.lang = lang === "en" ? "en" : "pt-BR";
        if (cvDownloadLink) {
          const linkHref =
            lang === "en"
              ? cvDownloadLink.getAttribute("data-cv-en")
              : cvDownloadLink.getAttribute("data-cv-pt");
          if (linkHref) {
            cvDownloadLink.setAttribute("href", linkHref);
          }
        }
      };

      const setLanguage = (lang) => {
        applyTranslations(lang);
        if (langToggle) {
          langToggle.textContent = lang === "en" ? "EN" : "PT";
        }
        if (langToggleMobile) {
          langToggleMobile.textContent = lang === "en" ? "EN" : "PT";
        }
        localStorage.setItem("portfolioLanguage", lang);
      };

      const toggleLanguage = () => {
        const current = localStorage.getItem("portfolioLanguage") || "pt";
        const next = current === "pt" ? "en" : "pt";
        setLanguage(next);
      };

      const initialLang = localStorage.getItem("portfolioLanguage") || "pt";
      setLanguage(initialLang);

      if (toggle && menu) {
        toggle.addEventListener("click", () => {
          const isExpanded = toggle.getAttribute("aria-expanded") === "true";
          toggle.setAttribute("aria-expanded", String(!isExpanded));
          menu.classList.toggle("hidden");
        });

        menu.addEventListener("click", (event) => {
          const target = event.target;
          if (target instanceof HTMLAnchorElement) {
            menu.classList.add("hidden");
            toggle.setAttribute("aria-expanded", "false");
          }
        });
      }

      if (langToggle) {
        langToggle.addEventListener("click", toggleLanguage);
      }

      if (langToggleMobile) {
        langToggleMobile.addEventListener("click", toggleLanguage);
      }

      const openCvModal = () => {
        if (!cvModal) return;
        cvModal.classList.remove("hidden");
        cvModal.classList.add("flex");
        cvModal.setAttribute("aria-hidden", "false");
      };

      const closeCvModal = () => {
        if (!cvModal) return;
        cvModal.classList.add("hidden");
        cvModal.classList.remove("flex");
        cvModal.setAttribute("aria-hidden", "true");
      };

      if (cvModalOpen) {
        cvModalOpen.addEventListener("click", openCvModal);
      }

      if (cvModalClose) {
        cvModalClose.addEventListener("click", closeCvModal);
      }

      if (cvModal) {
        cvModal.addEventListener("click", (event) => {
          const target = event.target;
          if (target === cvModal) {
            closeCvModal();
          }
          if (target instanceof HTMLElement && target.closest("[data-close-modal='true']")) {
            closeCvModal();
          }
        });
      }

      document.addEventListener("keydown", (event) => {
        if (event.key === "Escape") {
          closeCvModal();
        }
      });
    </script>
  </body>
</html>
